# 製品要件定義書 (PRD): 服薬管理アプリ "MyPill" (仮)

## 1. 製品概要
日本および英語圏市場をターゲットとした服薬管理アプリケーション。ユーザーが定刻に薬を服用できるようサポートし、家族や介護者が遠隔で服薬状況を見守ることができる機能を搭載する。

**コアバリュー:**
-   **信頼性:** 複雑な服薬スケジュールの管理を簡素化する。
-   **つながり:** シームレスな連携機能により、患者と介護者の距離を縮める。
-   **グローバル対応:** 海外渡航時の時差変更にもスマートに対応（自宅時間の維持 vs 現地時間への適応）。

## 2. ターゲットユーザー
1.  **メインユーザー:** 定期的な服薬が必要な個人（高齢者、多忙な社会人、旅行者）。
2.  **サブユーザー（見守り役）:** 離れて暮らす家族、子供の服薬を管理する両親。

## 3. 主要機能

### 3.1. 服薬管理
-   **薬の登録:**
    -   名称、用量、形状（アイコン）、色。
    -   オプション: 薬の写真。
    -   スケジュール: 毎日（X回）、特定の曜日、間隔指定（X日おき）。
    -   *在庫管理:* 総量を入力し、「服用」操作ごとに残数を減算。残量が少なくなった際（例：3日分以下）にアラートを表示。
-   **リマインダー:**
    -   プッシュ通知。
    -   「スヌーズ」および「スキップ」機能。
    -   重要通知（Critical Alerts）対応（マナーモード上書き、オプション設定）。

### 3.2. グローバル時差対応 (キラー機能)
-   **トラベルモード:**
    -   タイムゾーンの変更を検知。
    -   ユーザーによる選択:
        1.  **固定間隔（自国時間維持）:** 「太陽の動きに関係なく24時間ごとに服用」（例：インスリン）。
        2.  **現地時間適応:** 「朝の薬は現地の朝にずらす」。
-   **言語設定:**
    -   アプリ内設定で日本語と英語を即座に切り替え可能。

### 3.3. 家族・見守り連携
-   **連携メカニズム:**
    -   **招待生成:** ユーザーが固有の招待リンク（Dynamic Link等）またはQRコードを作成。
    -   **共有:** LINE、メール、メッセージアプリ等で送付。
    -   **接続:** 見守り役がアプリをインストール（またはWebビュー） -> スキャン/クリック -> 「連携完了」。
-   **見守りダッシュボード:**
    -   連携中の患者リスト表示。
    -   リアルタイムステータス: 「服用済み」「飲み忘れ」「在庫低下」。
    -   *プライバシー:* 患者側でいつでもアクセス権を取り消し可能。



### 3.4. AI飲み合わせチェック (実験的/将来機能)
-   *優先度:* 低 (実験的機能)。
-   *機能:* 薬同士、または薬と食品の飲み合わせ（相互作用）チェック。
-   *実装方針:*
    -   初期フェーズ: 一般的に避けるべき組み合わせの静的リスト（例：グレープフルーツ＋スタチン系）。
    -   将来: 信頼できる医療DBへのセキュアなAPIコール、または注意書き付きAIエージェントによる検索。

## 4. 技術仕様

### 4.1. アーキテクチャ
-   **フロントエンド:** Flutter (iOS/Android)。
-   **バックエンド:** Firebase (BaaS)。
    -   **Auth:** 匿名認証（開始時）、Email/パスワード、ソーシャルログイン（Google/Apple）。
    -   **Firestore:** リアルタイムDBによる同期。
    -   **Cloud Functions:** 複雑な招待フローや定期的な特定通知の処理。
    -   **Dynamic Links (または同等機能):** 招待用ディープリンク。

### 4.2. データプライバシー
-   Firestoreのセキュリティルールによる厳格な制御。
-   見守り役は、連携されたユーザーの特定のサブコレクションのみ読み取り可能。

## 5. マネタイズ
-   **モデル:** 無料 + 広告。
-   **広告配置:**
    -   メイン画面下部のバナー（操作を妨げない位置）。
    -   インタースティシャル（頻度低、設定完了後など非クリティカルなフローのみ） - *UXへの配慮必須。*
-   **アプリ内課金 (IAP) 候補:** 「広告の削除」（買い切り、または少額サブスクリプション）。

## 6. デザインガイドライン (UI/UX)
-   **トーン:** 信頼感、清潔感、医療的だが親しみやすい。
-   **スタイル:**
    -   高齢者にも見やすい高コントラスト対応。
    -   「子供っぽい」キャラクターは避け、プロフェッショナルなアイコンを使用。
    -   **カラーパレット:** 落ち着いた青、ティール（青緑）、明確な警告色（赤/オレンジ）。
-   **ウィジェット:** ホーム画面で素早く「服用」チェックができるウィジェット。

## 7. 未確定事項 / リスク
-   **ディープリンクの信頼性:** iOS/Androidの仕様変更に対応した慎重なセットアップが必要。
-   **通知の到達率:** バッテリー最適化機能が強力なAndroid端末での確実な通知動作の確保。
